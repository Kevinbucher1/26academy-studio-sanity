{"version":3,"file":"CodeMirrorProxy.cjs","sources":["../../src/codemirror/defaultCodeModes.ts","../../src/codemirror/extensions/backwardsCompatibleTone.ts","../../src/codemirror/extensions/highlightLineExtension.ts","../../src/codemirror/extensions/theme.ts","../../src/codemirror/extensions/useCodeMirrorTheme.ts","../../src/codemirror/extensions/useFontSize.ts","../../src/codemirror/CodeMirrorProxy.tsx"],"sourcesContent":["import {StreamLanguage} from '@codemirror/language'\nimport type {Extension} from '@codemirror/state'\n\nexport interface CodeMode {\n  name: string\n  loader: ModeLoader\n}\nexport type ModeLoader = () => Promise<Extension | undefined> | Extension | undefined\n\nexport const defaultCodeModes: CodeMode[] = [\n  {\n    name: 'groq',\n    loader: () =>\n      import('@codemirror/lang-javascript').then(({javascriptLanguage}) => javascriptLanguage),\n  },\n  {\n    name: 'javascript',\n    loader: () =>\n      import('@codemirror/lang-javascript').then(({javascript}) => javascript({jsx: false})),\n  },\n  {\n    name: 'jsx',\n    loader: () =>\n      import('@codemirror/lang-javascript').then(({javascript}) => javascript({jsx: true})),\n  },\n  {\n    name: 'typescript',\n    loader: () =>\n      import('@codemirror/lang-javascript').then(({javascript}) =>\n        javascript({jsx: false, typescript: true}),\n      ),\n  },\n  {\n    name: 'tsx',\n    loader: () =>\n      import('@codemirror/lang-javascript').then(({javascript}) =>\n        javascript({jsx: true, typescript: true}),\n      ),\n  },\n  {name: 'php', loader: () => import('@codemirror/lang-php').then(({php}) => php())},\n  {name: 'sql', loader: () => import('@codemirror/lang-sql').then(({sql}) => sql())},\n  {\n    name: 'mysql',\n    loader: () => import('@codemirror/lang-sql').then(({sql, MySQL}) => sql({dialect: MySQL})),\n  },\n  {name: 'json', loader: () => import('@codemirror/lang-json').then(({json}) => json())},\n  {\n    name: 'markdown',\n    loader: () => import('@codemirror/lang-markdown').then(({markdown}) => markdown()),\n  },\n  {name: 'java', loader: () => import('@codemirror/lang-java').then(({java}) => java())},\n  {name: 'html', loader: () => import('@codemirror/lang-html').then(({html}) => html())},\n  {\n    name: 'csharp',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/clike').then(({csharp}) =>\n        StreamLanguage.define(csharp),\n      ),\n  },\n  {\n    name: 'sh',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/shell').then(({shell}) => StreamLanguage.define(shell)),\n  },\n  {\n    name: 'css',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/css').then(({css}) => StreamLanguage.define(css)),\n  },\n  {\n    name: 'scss',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/css').then(({css}) => StreamLanguage.define(css)),\n  },\n  {\n    name: 'sass',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/sass').then(({sass}) => StreamLanguage.define(sass)),\n  },\n  {\n    name: 'ruby',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/ruby').then(({ruby}) => StreamLanguage.define(ruby)),\n  },\n  {\n    name: 'python',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/python').then(({python}) =>\n        StreamLanguage.define(python),\n      ),\n  },\n  {\n    name: 'xml',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/xml').then(({xml}) => StreamLanguage.define(xml)),\n  },\n  {\n    name: 'yaml',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/yaml').then(({yaml}) => StreamLanguage.define(yaml)),\n  },\n  {\n    name: 'golang',\n    loader: () =>\n      import('@codemirror/legacy-modes/mode/go').then(({go}) => StreamLanguage.define(go)),\n  },\n  {name: 'text', loader: () => undefined},\n  {name: 'batch', loader: () => undefined},\n]\n","import type {ThemeContextValue} from '@sanity/ui'\n\n/**\n * `@sanity/ui@v2.9` introduced two new tones; \"neutral\" and \"suggest\",\n * which maps to \"default\" and \"primary\" respectively in the old theme.\n * This function returns the \"backwards compatible\" tone value.\n *\n * @returns The tone value that is backwards compatible with the old theme.\n * @internal\n */\nexport function getBackwardsCompatibleTone(\n  themeCtx: ThemeContextValue,\n): Exclude<ThemeContextValue['tone'], 'neutral' | 'suggest'> {\n  if (themeCtx.tone !== 'neutral' && themeCtx.tone !== 'suggest') {\n    return themeCtx.tone\n  }\n\n  return themeCtx.tone === 'neutral' ? 'default' : 'primary'\n}\n","/* eslint-disable no-param-reassign */\n\nimport {type Extension, StateEffect, StateField} from '@codemirror/state'\nimport {Decoration, type DecorationSet, EditorView, lineNumbers} from '@codemirror/view'\nimport type {ThemeContextValue} from '@sanity/ui'\nimport {rgba} from '@sanity/ui/theme'\n\nimport {getBackwardsCompatibleTone} from './backwardsCompatibleTone'\n\nconst highlightLineClass = 'cm-highlight-line'\n\nexport const addLineHighlight = StateEffect.define<number>()\nexport const removeLineHighlight = StateEffect.define<number>()\n\nexport const lineHighlightField = StateField.define({\n  create() {\n    return Decoration.none\n  },\n  update(lines, tr) {\n    lines = lines.map(tr.changes)\n    for (const e of tr.effects) {\n      if (e.is(addLineHighlight)) {\n        lines = lines.update({add: [lineHighlightMark.range(e.value)]})\n      }\n      if (e.is(removeLineHighlight)) {\n        lines = lines.update({\n          filter: (from) => {\n            // removeLineHighlight value is lineStart for the highlight, so keep other effects\n            return from !== e.value\n          },\n        })\n      }\n    }\n    return lines\n  },\n  toJSON(value, state) {\n    const highlightLines: number[] = []\n    const iter = value.iter()\n    while (iter.value) {\n      const lineNumber = state.doc.lineAt(iter.from).number\n      if (!highlightLines.includes(lineNumber)) {\n        highlightLines.push(lineNumber)\n      }\n      iter.next()\n    }\n    return highlightLines\n  },\n  fromJSON(value: number[], state) {\n    const lines = state.doc.lines\n    const highlights = value\n      .filter((line) => line <= lines) // one-indexed\n      .map((line) => lineHighlightMark.range(state.doc.line(line).from))\n    highlights.sort((a, b) => a.from - b.from)\n    try {\n      return Decoration.none.update({\n        add: highlights,\n      })\n    } catch (e) {\n      console.error(e)\n      return Decoration.none\n    }\n  },\n  provide: (f) => EditorView.decorations.from(f),\n})\n\nconst lineHighlightMark = Decoration.line({\n  class: highlightLineClass,\n})\n\nexport const highlightState: {\n  [prop: string]: StateField<DecorationSet>\n} = {\n  highlight: lineHighlightField,\n}\n\nexport interface HighlightLineConfig {\n  onHighlightChange?: (lines: number[]) => void\n  readOnly?: boolean\n  theme: ThemeContextValue\n}\n\nfunction createCodeMirrorTheme(options: {themeCtx: ThemeContextValue}) {\n  const {themeCtx} = options\n\n  const fallbackTone = getBackwardsCompatibleTone(themeCtx)\n\n  const dark = {color: themeCtx.theme.color.dark[fallbackTone]}\n  const light = {color: themeCtx.theme.color.light[fallbackTone]}\n\n  return EditorView.baseTheme({\n    '.cm-lineNumbers': {\n      cursor: 'default',\n    },\n    '.cm-line.cm-line': {\n      position: 'relative',\n    },\n\n    // need set background with pseudoelement so it does not render over selection color\n    [`.${highlightLineClass}::before`]: {\n      position: 'absolute',\n      top: 0,\n      bottom: 0,\n      left: 0,\n      right: 0,\n      zIndex: -3,\n      content: \"''\",\n      boxSizing: 'border-box',\n    },\n    [`&dark .${highlightLineClass}::before`]: {\n      background: rgba(dark.color.muted.caution.pressed.bg, 0.5),\n    },\n    [`&light .${highlightLineClass}::before`]: {\n      background: rgba(light.color.muted.caution.pressed.bg, 0.75),\n    },\n  })\n}\n\nexport const highlightLine = (config: HighlightLineConfig): Extension => {\n  const highlightTheme = createCodeMirrorTheme({themeCtx: config.theme})\n\n  return [\n    lineHighlightField,\n    config.readOnly\n      ? []\n      : lineNumbers({\n          domEventHandlers: {\n            mousedown: (editorView, lineInfo) => {\n              // Determine if the line for the clicked gutter line number has highlighted state or not\n              const line = editorView.state.doc.lineAt(lineInfo.from)\n              let isHighlighted = false\n              editorView.state\n                .field(lineHighlightField)\n                .between(line.from, line.to, (from, to, value) => {\n                  if (value) {\n                    isHighlighted = true\n                    return false // stop iteration\n                  }\n                  return undefined\n                })\n\n              if (isHighlighted) {\n                editorView.dispatch({effects: removeLineHighlight.of(line.from)})\n              } else {\n                editorView.dispatch({effects: addLineHighlight.of(line.from)})\n              }\n              if (config?.onHighlightChange) {\n                config.onHighlightChange(editorView.state.toJSON(highlightState).highlight)\n              }\n              return true\n            },\n          },\n        }),\n    highlightTheme,\n  ]\n}\n\n/**\n * Adds and removes highlights to the provided view using highlightLines\n * @param view\n * @param highlightLines\n */\nexport function setHighlightedLines(view: EditorView, highlightLines: number[]): void {\n  const doc = view.state.doc\n  const lines = doc.lines\n  //1-based line numbers\n  const allLineNumbers = Array.from({length: lines}, (x, i) => i + 1)\n  view.dispatch({\n    effects: allLineNumbers.map((lineNumber) => {\n      const line = doc.line(lineNumber)\n      if (highlightLines?.includes(lineNumber)) {\n        return addLineHighlight.of(line.from)\n      }\n      return removeLineHighlight.of(line.from)\n    }),\n  })\n}\n","import type {Extension} from '@codemirror/state'\nimport {EditorView} from '@codemirror/view'\nimport {useRootTheme} from '@sanity/ui'\nimport {rgba} from '@sanity/ui/theme'\nimport {useMemo} from 'react'\n\nimport {getBackwardsCompatibleTone} from './backwardsCompatibleTone'\n\nexport function useThemeExtension(): Extension {\n  const themeCtx = useRootTheme()\n\n  return useMemo(() => {\n    const fallbackTone = getBackwardsCompatibleTone(themeCtx)\n    const dark = {color: themeCtx.theme.color.dark[fallbackTone]}\n    const light = {color: themeCtx.theme.color.light[fallbackTone]}\n\n    return EditorView.baseTheme({\n      '&.cm-editor': {\n        height: '100%',\n      },\n      '&.cm-editor.cm-focused': {\n        outline: 'none',\n      },\n\n      // Matching brackets\n      '&.cm-editor.cm-focused .cm-matchingBracket': {\n        backgroundColor: 'transparent',\n      },\n      '&.cm-editor.cm-focused .cm-nonmatchingBracket': {\n        backgroundColor: 'transparent',\n      },\n      '&dark.cm-editor.cm-focused .cm-matchingBracket': {\n        outline: `1px solid ${dark.color.base.border}`,\n      },\n      '&dark.cm-editor.cm-focused .cm-nonmatchingBracket': {\n        outline: `1px solid ${dark.color.base.border}`,\n      },\n      '&light.cm-editor.cm-focused .cm-matchingBracket': {\n        outline: `1px solid ${light.color.base.border}`,\n      },\n      '&light.cm-editor.cm-focused .cm-nonmatchingBracket': {\n        outline: `1px solid ${light.color.base.border}`,\n      },\n\n      // Size and padding of gutter\n      '& .cm-lineNumbers .cm-gutterElement': {\n        minWidth: `32px !important`,\n        padding: `0 8px !important`,\n      },\n      '& .cm-gutter.cm-foldGutter': {\n        width: `0px !important`,\n      },\n\n      // Color of gutter\n      '&dark .cm-gutters': {\n        color: `${rgba(dark.color.card.enabled.code.fg, 0.5)} !important`,\n        borderRight: `1px solid ${rgba(dark.color.base.border, 0.5)}`,\n      },\n      '&light .cm-gutters': {\n        color: `${rgba(light.color.card.enabled.code.fg, 0.5)} !important`,\n        borderRight: `1px solid ${rgba(light.color.base.border, 0.5)}`,\n      },\n    })\n  }, [themeCtx])\n}\n","import type {Extension} from '@codemirror/state'\nimport {tags as t} from '@lezer/highlight'\nimport {useTheme} from '@sanity/ui'\nimport {rgba} from '@sanity/ui/theme'\nimport {createTheme} from '@uiw/codemirror-themes'\nimport {useMemo} from 'react'\n\nexport function useCodeMirrorTheme(): Extension {\n  const theme = useTheme()\n\n  return useMemo(() => {\n    const {code: codeFont} = theme.sanity.fonts\n    const {base, card, dark, syntax} = theme.sanity.color\n\n    return createTheme({\n      theme: dark ? 'dark' : 'light',\n      settings: {\n        background: card.enabled.bg,\n        foreground: card.enabled.code.fg,\n        lineHighlight: card.enabled.bg,\n        fontFamily: codeFont.family,\n        caret: base.focusRing,\n        selection: rgba(base.focusRing, 0.2),\n        selectionMatch: rgba(base.focusRing, 0.4),\n        gutterBackground: card.disabled.bg,\n        gutterForeground: card.disabled.code.fg,\n        gutterActiveForeground: card.enabled.fg,\n      },\n      styles: [\n        {\n          tag: [t.heading, t.heading2, t.heading3, t.heading4, t.heading5, t.heading6],\n          color: card.enabled.fg,\n        },\n        {tag: t.angleBracket, color: card.enabled.code.fg},\n        {tag: t.atom, color: syntax.keyword},\n        {tag: t.attributeName, color: syntax.attrName},\n        {tag: t.bool, color: syntax.boolean},\n        {tag: t.bracket, color: card.enabled.code.fg},\n        {tag: t.className, color: syntax.className},\n        {tag: t.comment, color: syntax.comment},\n        {tag: t.definition(t.typeName), color: syntax.function},\n        {\n          tag: [\n            t.definition(t.variableName),\n            t.function(t.variableName),\n            t.className,\n            t.attributeName,\n          ],\n          color: syntax.function,\n        },\n        {tag: [t.function(t.propertyName), t.propertyName], color: syntax.function},\n        {tag: t.keyword, color: syntax.keyword},\n        {tag: t.null, color: syntax.number},\n        {tag: t.number, color: syntax.number},\n        {tag: t.meta, color: card.enabled.code.fg},\n        {tag: t.operator, color: syntax.operator},\n        {tag: t.propertyName, color: syntax.property},\n        {tag: [t.string, t.special(t.brace)], color: syntax.string},\n        {tag: t.tagName, color: syntax.className},\n        {tag: t.typeName, color: syntax.keyword},\n      ],\n    })\n  }, [theme])\n}\n","import type {Extension} from '@codemirror/state'\nimport {EditorView} from '@codemirror/view'\nimport {rem, useTheme} from '@sanity/ui'\nimport {useMemo} from 'react'\n\nexport function useFontSizeExtension(props: {fontSize: number}): Extension {\n  const {fontSize: fontSizeProp} = props\n  const theme = useTheme()\n\n  return useMemo(() => {\n    const {code: codeFont} = theme.sanity.fonts\n    const {fontSize, lineHeight} = codeFont.sizes[fontSizeProp] || codeFont.sizes[2]\n\n    return EditorView.baseTheme({\n      '&': {\n        fontSize: rem(fontSize),\n      },\n\n      '& .cm-scroller': {\n        lineHeight: `${lineHeight / fontSize} !important`,\n      },\n    })\n  }, [fontSizeProp, theme])\n}\n","import type {Extension} from '@codemirror/state'\nimport {EditorView} from '@codemirror/view'\nimport {useRootTheme} from '@sanity/ui'\nimport CodeMirror, {type ReactCodeMirrorProps, type ReactCodeMirrorRef} from '@uiw/react-codemirror'\nimport {forwardRef, useCallback, useContext, useEffect, useMemo, useState} from 'react'\n\nimport {CodeInputConfigContext} from './CodeModeContext'\nimport {defaultCodeModes} from './defaultCodeModes'\nimport {\n  highlightLine,\n  highlightState,\n  setHighlightedLines,\n} from './extensions/highlightLineExtension'\nimport {useThemeExtension} from './extensions/theme'\nimport {useCodeMirrorTheme} from './extensions/useCodeMirrorTheme'\nimport {useFontSizeExtension} from './extensions/useFontSize'\n\nexport interface CodeMirrorProps extends ReactCodeMirrorProps {\n  highlightLines?: number[]\n  languageMode?: string\n  onHighlightChange?: (lines: number[]) => void\n}\n\n/**\n * CodeMirrorProxy is a wrapper component around CodeMirror that we lazy load to reduce initial bundle size.\n *\n * It is also responsible for integrating any CodeMirror extensions.\n */\nconst CodeMirrorProxy = forwardRef<ReactCodeMirrorRef, CodeMirrorProps>(\n  function CodeMirrorProxy(props, ref) {\n    const {\n      basicSetup: basicSetupProp,\n      highlightLines,\n      languageMode,\n      onHighlightChange,\n      readOnly,\n      value,\n      ...codeMirrorProps\n    } = props\n\n    const themeCtx = useRootTheme()\n    const codeMirrorTheme = useCodeMirrorTheme()\n    const [editorView, setEditorView] = useState<EditorView | undefined>(undefined)\n\n    // Resolve extensions\n    const themeExtension = useThemeExtension()\n    const fontSizeExtension = useFontSizeExtension({fontSize: 1})\n    const languageExtension = useLanguageExtension(languageMode)\n    const highlightLineExtension = useMemo(\n      () =>\n        highlightLine({\n          onHighlightChange,\n          readOnly,\n          theme: themeCtx,\n        }),\n      [onHighlightChange, readOnly, themeCtx],\n    )\n\n    const extensions = useMemo(() => {\n      const baseExtensions = [\n        themeExtension,\n        fontSizeExtension,\n        highlightLineExtension,\n        EditorView.lineWrapping,\n      ]\n      if (languageExtension) {\n        return [...baseExtensions, languageExtension]\n      }\n      return baseExtensions\n    }, [fontSizeExtension, highlightLineExtension, languageExtension, themeExtension])\n\n    useEffect(() => {\n      if (editorView) {\n        setHighlightedLines(editorView, highlightLines ?? [])\n      }\n    }, [editorView, highlightLines, value])\n\n    const initialState = useMemo(() => {\n      return {\n        json: {\n          doc: value ?? '',\n          selection: {\n            main: 0,\n            ranges: [{anchor: 0, head: 0}],\n          },\n          highlight: highlightLines ?? [],\n        },\n        fields: highlightState,\n      }\n      // only need to calculate this on initial render\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [])\n\n    const handleCreateEditor = useCallback((view: EditorView) => {\n      setEditorView(view)\n    }, [])\n\n    const basicSetup = useMemo(\n      () =>\n        basicSetupProp ?? {\n          highlightActiveLine: false,\n        },\n      [basicSetupProp],\n    )\n\n    return (\n      <CodeMirror\n        {...codeMirrorProps}\n        value={value}\n        ref={ref}\n        extensions={extensions}\n        theme={codeMirrorTheme}\n        onCreateEditor={handleCreateEditor}\n        initialState={initialState}\n        basicSetup={basicSetup}\n      />\n    )\n  },\n)\n\nfunction useLanguageExtension(mode?: string) {\n  const codeConfig = useContext(CodeInputConfigContext)\n\n  const [languageExtension, setLanguageExtension] = useState<Extension | undefined>()\n\n  useEffect(() => {\n    const customModes = codeConfig?.codeModes ?? []\n    const modes = [...customModes, ...defaultCodeModes]\n\n    const codeMode = modes.find((m) => m.name === mode)\n    if (!codeMode?.loader) {\n      console.warn(\n        `Found no codeMode for language mode ${mode}, syntax highlighting will be disabled.`,\n      )\n    }\n    let active = true\n    Promise.resolve(codeMode?.loader())\n      .then((extension) => {\n        if (active) {\n          setLanguageExtension(extension)\n        }\n      })\n      .catch((e) => {\n        console.error(`Failed to load language mode ${mode}`, e)\n        if (active) {\n          setLanguageExtension(undefined)\n        }\n      })\n    return () => {\n      active = false\n    }\n  }, [mode, codeConfig])\n\n  return languageExtension\n}\n\nexport default CodeMirrorProxy\n"],"names":["StreamLanguage","StateEffect","StateField","Decoration","state","EditorView","rgba","lineNumbers","view","useRootTheme","useMemo","theme","useTheme","createTheme","t","rem","forwardRef","useState","useEffect","useCallback","jsx","CodeMirror","useContext","CodeInputConfigContext"],"mappings":"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"}